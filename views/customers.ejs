<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Saved Bills | Mughal Molding</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark py-3 mb-4">
    <div class="container d-flex justify-content-between align-items-center">
        <h4 class="text-white mb-0 fw-bold">üìú Saved Bills Record</h4>
        
        <div class="d-flex gap-2">
            <button onclick="deleteAllBills()" class="btn btn-danger btn-sm fw-bold shadow-sm border border-light">
                <i class="bi bi-trash-fill"></i> Delete All Bills
            </button>
            
            <a href="/" class="btn btn-outline-light btn-sm">Dashboard</a>
        </div>
    </div>
</nav>

<div class="container bg-white p-4 shadow rounded">
    <div class="table-responsive">
        <table class="table table-hover align-middle table-striped border">
            <thead class="table-dark">
                <tr>
                    <th>Date & Time</th>
                    <th>Customer Name</th>
                    <th>Phone</th>
                    <th>Total Bill</th>
                    <th>Advance</th>
                    <th>Remaining</th>
                    <th class="text-end">Action</th>
                </tr>
            </thead>
            <tbody>
                <% if (records.length > 0) { %>
                    <% records.forEach(r => { %>
                        <tr>
                            <td class="fw-bold text-muted small"><%= new Date(r.created_at).toLocaleString() %></td>
                            <td class="fw-bold text-primary"><%= r.customer_name %></td>
                            <td><%= r.customer_phone %></td>
                            <td class="fw-bold">Rs. <%= r.total_amount %></td>
                            <td class="text-success">Rs. <%= r.advance_paid %></td>
                            <td class="text-danger fw-bold">Rs. <%= r.remaining_balance %></td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-info text-white" onclick="alert('Items Details:\n' + `<%= r.items_json %>`)">
                                    <i class="bi bi-eye-fill"></i> View
                                </button>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="7" class="text-center py-5 text-muted fw-bold">Abhi tak koi Bill save nahi hua.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<script>
    function deleteAllBills() {
        // Step 1: Password poocho
        let pass = prompt("üõë DANGER ZONE! \n\nTamam Saved Bills delete ho jayen ge!\nPassword likhein:");
        
        if (pass === "mughal123") {
            // Step 2: Final Confirmation
            if (confirm("‚ö†Ô∏è Kya aap 100% sure hain?\nYe data wapis nahi aayega!")) {
                window.location.href = "/delete_all_bills_confirm";
            }
        } else if (pass !== null) {
            alert("‚ùå Ghalat Password!");
        }
    }
</script>

</body>
</html>